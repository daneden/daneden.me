/**
 * ReSRCit v0.9.3
 * http://www.resrc.it
 * Copyright (C) 2014-2015 ReSRC Ltd.
 */

!function(a){"use strict";a.options=a.options||{};var b={server:"app.resrc.it",resrcClass:"resrc",resrcOnResize:!0,resrcOnResizeDown:!1,resrcOnPinch:!1,imageQuality:85,pixelRounding:10,ssl:!1},c=!1,d=200,e=0;Array.prototype.indexOf||(Array.prototype.indexOf=function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var f=function(a,b){if(a&&b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},g=f(b,a.options),h=function(b){return f(g,b),a},i=function(a){if("undefined"!=typeof document.getElementsByClassName)return document.getElementsByClassName(a);for(var b=[],c=new RegExp("(^|\\s)"+a+"(\\s|$)"),d=document.getElementsByTagName("*"),e=0,f=d.length;f>e;e++)d[e].className.match(c)&&b.push(d[e]);return b},j=function(a){var b={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/};a=a.replace(/@/g,"%40");for(var c=b.parser.exec(a),d={},e=14;e--;)d[b.key[e]]=c[e]||"";d[b.q.name]={},d[b.key[12]].replace(b.q.parser,function(a,c,e){c&&(d[b.q.name][c]=e)});var f=d.file.split(".");return d.filename=f[0],d.ext=f.length>1?f[f.length-1]:"",d},k=function(a){return a===!0?"https://":"http://"},l=function(a){var b,c,d,e,f=j(a);return b=f.query?f.path+"?"+f.query:f.path,c=/(https?):|(\/\/)/,d=b.search(c),e=b.substring(d),-1===e.indexOf("://")&&(e=e.replace("//",k(g.ssl))),"/"===e.charAt(0)&&(e=e.replace("/",k(g.ssl))),e},m=function(a){var b,c,d,e,f;return b=a,c="//",e=/\/(https?):/,d=b.lastIndexOf(c),f=b.slice(0,d).replace(e,"")},n=function(a,b){if(a.match(/\/\//g).length>1){var c=j(a);return c.authority!==b?a.replace(c.protocol+"://"+c.authority,k(g.ssl)+b):a}return k(g.ssl)+b+"/"+a},o=function(a){var b=/\((.*?)\)/g;return b.test(a)},p=function(a){for(var b,c=[],d=/\((.*?)\)/g;null!==(b=d.exec(a));)c.push(b[1].trim());return c.toString()},q=function(a,b){return Math.ceil(a/b)*b},r=function(){return/iPhone|iPod|iPad/i.test(navigator.userAgent)},s=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},t=function(a,b){return o(b)?a+"="+p(b):a+"="+b},u=function(a,b){for(var c=a.length;c--;)if(""===b){if(""===a[c])return c}else{var d=new RegExp(b),e=d.exec(a[c]);if(null!==e)return c}return-1},v=function(){var a=Math.round(screen.width/window.innerWidth*10)/10;return 1>=a?1:a},w=function(a){var b=a.getAttribute("data-dpi"),c=window.devicePixelRatio?window.devicePixelRatio:1,d=s(b)===!0?parseFloat(b):c;return d%1!==0&&(d=d.toFixed(1)),d},x=function(a){return a.getAttribute("data-server")||g.server},y=function(a){return a.tagName.toLowerCase()},z=function(){return document.documentElement.clientWidth||document.body&&document.body.clientWidth||1024},A=function(){return document.documentElement.clientHeight||document.body&&document.body.clientHeight||768},B=function(a){return a.getAttribute("data-src")||a.getAttribute("src")},C=function(a){return a.split("=")[0]},D=function(a){return a.split("=")[1]},E=function(a){var b={};if(b.width=a.offsetWidth,b.height=a.offsetHeight,null===a.parentNode)return b.width=z(),b.height=A(),b;if(0!==b.width||0!==b.height)return a.alt&&!a.resrc?(a.resrc=!0,E(a.parentNode)):b;var c,d,e={},f={position:"absolute",visibility:"hidden",display:"block"};for(d in f)f.hasOwnProperty(d)&&(e[d]=a.style[d],a.style[d]=f[d]);c=b;for(d in f)f.hasOwnProperty(d)&&(a.style[d]=e[d]);return 0===c.width||0===c.height?E(a.parentNode):c},F=function(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}},G=function(){N(this)},H=function(){e!==z()&&K()},I=function(a){a.addEventListener&&!a.eventListenerAdded&&(a.addEventListener("gestureend",G,!1),a.eventListenerAdded=!0)},J=function(){window.addEventListener?window.addEventListener("resize",H,!1):window.attachEvent&&window.attachEvent("onresize",H),c=!0},K=F(function(){O(),e=z()},d),L=function(a){function b(a){for(n=1;a=d.shift();)a()}var c,d=[],e=!1,f=document,g=f.documentElement,h=g.doScroll,i="DOMContentLoaded",j="addEventListener",k="onreadystatechange",l="readyState",m=h?/^loaded|^c/:/^loaded|c/,n=m.test(f[l]);return f[j]&&f[j](i,c=function(){f.removeEventListener(i,c,e),b()},e),h&&f.attachEvent(k,c=function(){/^c/.test(f[l])&&(f.detachEvent(k,c),b())}),a=h?function(b){self!==top?n?b():d.push(b):function(){try{g.doScroll("left")}catch(c){return setTimeout(function(){a(b)},50)}b()}()}:function(a){n?a():d.push(a)}}(),M=function(a){var b,c=[],d=w(a),e=g.pixelRounding,f=r()?v():1,h=E(a),i=q(h.width*f,e),o=q(h.height*f,e),p=x(a),s=n(B(a),p),y=m(s),z=j(y).directory.toLowerCase().substring(1),A=i>=o==!0?t("s","w"+i+",pd"+d):t("s","h"+o+",pd"+d),F=l(s);if(z){c=z.split("/");for(var G=c.length;G--;)c[G]=D(c[G])?t(C(c[G]),D(c[G])):C(c[G]);var H=u(c,"o=.*"),I=u(c,"c=.*"),J=u(c,"s=.*");-1!==H?c.splice(H,1,c[H]):c.push(t("o",g.imageQuality)),-1!==J?-1!==I?c.splice(-1,0,A):c.splice(J,1,A):c.splice(-1,0,A)}else c.push(A),c.push(t("o",g.imageQuality));return z=c.join("/"),b=k(g.ssl)+p+"/"+z+"/"+F,{resrcImgPath:b,fallbackImgPath:F,width:i,height:o,params:z,server:p}},N=function(a){var b=M(a),c=b.resrcImgPath,d=b.fallbackImgPath,e=b.width;if(a.lastWidth=a.lastWidth||0,!(g.resrcOnResizeDown===!1&&a.lastWidth>=e)){if("img"===y(a))a.src=c,a.onerror=function(){this.src=d,this.onerror=null};else{var f=new Image;f.src=c,a.style.backgroundImage="url("+c+")",f.onerror=function(){a.style.backgroundImage="url("+d+")"}}a.lastWidth=e}},O=function(a){var b;if(null!==a){b=a?a.length?a:[a]:i(g.resrcClass);for(var d=0;d<b.length;d++){if(null===b[d])return;g.resrcOnPinch&&I(b[d]),N(b[d])}g.resrcOnResize&&!c&&J()}};a.ready=L,a.run=O,a.getResrcImageObject=M,a.getElementsByClassName=i,a.options=g,a.extend=f,a.configure=h}(window.resrc=window.resrc||{});
